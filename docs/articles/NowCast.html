<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NowCast • AirMonitor</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="NowCast">
<meta property="og:description" content="AirMonitor">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AirMonitor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/AirMonitor.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Data_Model.html">Data Model</a>
    </li>
    <li>
      <a href="../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
    <li>
      <a href="../articles/Citations.html">Citations</a>
    </li>
    <li>
      <a href="../articles/NowCast.html">NowCast</a>
    </li>
    <li>
      <a href="../articles/Save_Data_as_CSV.html">Example: Save Data as CSV</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/AirMonitor/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>NowCast</h1>
                        <h4 data-toc-skip class="author">Rex Thompson
and Jonathan Callahan</h4>
            
            <h4 data-toc-skip class="date">2022-10-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/AirMonitor/blob/HEAD/vignettes/articles/NowCast.Rmd" class="external-link"><code>vignettes/articles/NowCast.Rmd</code></a></small>
      <div class="hidden name"><code>NowCast.Rmd</code></div>

    </div>

    
    
<p>This vignette documents the <code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> function,
which converts a <em>mts_monitor</em> object’s values to NowCast values.
We provide details on the NowCast algorithm and our implementation of
it. We also provide examples to highlight specific attributes and
potential points of confusion in the algorithm.</p>
<p>This vignette also briefly covers the <code><a href="../reference/monitor_aqi.html">monitor_aqi()</a></code>
function, which uses the <code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> function to
convert raw PM2.5 data into NowCast-based AQI values.</p>
<div class="section level2">
<h2 id="what-is-nowcast">What is NowCast?<a class="anchor" aria-label="anchor" href="#what-is-nowcast"></a>
</h2>
<p>NowCast is an air quality data smoothing algorithm that puts an
emphasis on recent values when measurements are unstable, and approaches
a long-term (<em>e.g.</em> 12-hour) average when measurements are
stable.</p>
<p>The original algorithm, known as the Conroy method, was developed in
2003 to make real-time air quality measurements roughly comparable to
established regulatory air quality health thresholds (<em>e.g.</em>
24‐hour PM2.5 standards). However, that method was shown to be slow to
respond to rapidly changing air quality conditions, which, at best,
reduced public confidence in disseminated AQI values an, at worst, had
the potential to adversely affect the health of those in high impact
areas (<em>e.g.</em> near wildfires).</p>
<p>In response, EPA developed a new method – the Reff method – in 2013
to be more responsive to rapidly changing air quality conditions. The
<strong>AirMonitor</strong> package provides support for applying the
new NowCast algorithm to hourly PM2.5 data, though theoretically it
could be applied to regular-interval time series data of any type,
including other criteria pollutants.</p>
<p>Algorithm specifics are provided below.</p>
<p>Sources:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/NowCast_(air_quality_index)" class="external-link uri">https://en.wikipedia.org/wiki/NowCast_(air_quality_index)</a></li>
<li><a href="https://forum.airnowtech.org/t/the-nowcast-for-pm2-5-and-pm10/172" class="external-link uri">https://forum.airnowtech.org/t/the-nowcast-for-pm2-5-and-pm10/172</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="the-nowcast-algorithm-reff-method">The NowCast Algorithm (Reff Method)<a class="anchor" aria-label="anchor" href="#the-nowcast-algorithm-reff-method"></a>
</h2>
<div class="section level3">
<h3 id="nowcast-equation-for-pm-data-pm2-5-or-pm10">NowCast Equation for PM Data (PM<sub>2.5</sub> or
PM<sub>10</sub>)<a class="anchor" aria-label="anchor" href="#nowcast-equation-for-pm-data-pm2-5-or-pm10"></a>
</h3>
<p>The NowCast value for a given hour can be calculated as follows:</p>
<p><span class="math display">\[
NowCast = \frac{\sum_{i=1}^{12}{w^{i-1}c_i}}{\sum_{i=1}^{12}w^{i-1}}
\]</span></p>
<p>where <span class="math inline">\(i\)</span>, <span class="math inline">\(w\)</span> and <span class="math inline">\(c\)</span> are as defined in the sections
below.</p>
<p>Source:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/NowCast_(air_quality_index)" class="external-link uri">https://en.wikipedia.org/wiki/NowCast_(air_quality_index)</a></li>
</ul>
</div>
<div class="section level3">
<h3 id="data-selection">Data Selection<a class="anchor" aria-label="anchor" href="#data-selection"></a>
</h3>
<p>For PM2.5 data, the NowCast algorithm uses hourly averages from the
prior 12 clock hours.</p>
<p>The hourly averages are denoted below by <span class="math inline">\(c_i\)</span>, where <span class="math inline">\(i\)</span> represents the number of hours before
present. For example, <span class="math inline">\(c_1\)</span>, <span class="math inline">\(c_2\)</span>, <span class="math inline">\(c_3\)</span>, <span class="math inline">\(...\)</span>, <span class="math inline">\(c_N\)</span> represent the hourly averages for the
most recent 1, 2, 3, <span class="math inline">\(...\)</span>, <span class="math inline">\(N\)</span> hours.</p>
<p>Source:</p>
<ul>
<li><a href="https://forum.airnowtech.org/t/the-nowcast-for-pm2-5-and-pm10/172" class="external-link uri">https://forum.airnowtech.org/t/the-nowcast-for-pm2-5-and-pm10/172</a></li>
</ul>
</div>
<div class="section level3">
<h3 id="weight-factor">Weight Factor<a class="anchor" aria-label="anchor" href="#weight-factor"></a>
</h3>
<p>Using data points as specified above, define the weight factor <span class="math inline">\(w^*\)</span> as follows:</p>
<p><span class="math display">\[
w^* = 1- \frac{c_{max}-c_{min}}{c_{max}} = \frac{c_{min}}{c_{max}}
\]</span></p>
<p>where</p>
<ul>
<li>
<span class="math inline">\(c_{max}\)</span> = the highest value in
<span class="math inline">\(c_1\)</span>, <span class="math inline">\(...\)</span>, <span class="math inline">\(c_N\)</span>
</li>
<li>
<span class="math inline">\(c_{min}\)</span> = the lowest value in
<span class="math inline">\(c_1\)</span>, <span class="math inline">\(...\)</span>, <span class="math inline">\(c_N\)</span>
</li>
</ul>
<p>NowCast-related literature usually gives the equation for <span class="math inline">\(w^*\)</span> in one of two basic forms, both of
which are included above for reference. Note that both forms are
equivalent.</p>
<p>Sources:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/NowCast_(air_quality_index)" class="external-link uri">https://en.wikipedia.org/wiki/NowCast_(air_quality_index)</a></li>
<li><a href="https://forum.airnowtech.org/t/the-nowcast-for-pm2-5-and-pm10/172" class="external-link uri">https://forum.airnowtech.org/t/the-nowcast-for-pm2-5-and-pm10/172</a></li>
</ul>
</div>
<div class="section level3">
<h3 id="minimum-weight-factor">Minimum Weight Factor<a class="anchor" aria-label="anchor" href="#minimum-weight-factor"></a>
</h3>
<p>Before plugging into the NowCast equation, <span class="math inline">\(w*\)</span> is updated to <span class="math inline">\(w\)</span> for PM2.5 and PM10 as follows:</p>
<p><span class="math display">\[
w =
\begin{cases}
w^*         &amp; \text{if} &amp; w^*&gt;\frac{1}{2} \\
\frac{1}{2} &amp; \text{if} &amp; w^*\leq \frac{1}{2}  \\
\end{cases}
\]</span></p>
<p>Source</p>
<ul>
<li><a href="https://forum.airnowtech.org/t/the-nowcast-for-pm2-5-and-pm10/172" class="external-link uri">https://forum.airnowtech.org/t/the-nowcast-for-pm2-5-and-pm10/172</a></li>
</ul>
</div>
<div class="section level3">
<h3 id="truncation">Truncation<a class="anchor" aria-label="anchor" href="#truncation"></a>
</h3>
<p>Final NowCast values are truncated based on the type of data being
processed:</p>
<ul>
<li>
<strong>PM2.5</strong>: 0.1 µg/m3</li>
<li>
<strong>PM10</strong>: 1 µg/m3</li>
</ul>
<p>Source:</p>
<ul>
<li><a href="https://forum.airnowtech.org/t/the-nowcast-for-pm2-5-and-pm10/172" class="external-link uri">https://forum.airnowtech.org/t/the-nowcast-for-pm2-5-and-pm10/172</a></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="algorithm-expansion">Algorithm Expansion<a class="anchor" aria-label="anchor" href="#algorithm-expansion"></a>
</h2>
<p>For PM2.5, the NowCast equation can be expanded as follows:</p>
<p><span class="math display">\[
NowCast = \frac
{w^0c_1 + w^1c_2 + w^2c_3 + w^3c_4 + w^4c_5 + w^5c_6 + w^6c_7 + w^7c_8 +
w^8c_9 + w^9c_{10} + w^{10}c_{11} + w^{11}c_{12}}
{w^0 + w^1 + w^2 + w^3 + w^4 + w^5 + w^6 + w^7 + w^8 + w^9 + w^{10} +
w^{11}}
\]</span></p>
<p>Note that:</p>
<ul>
<li>
<span class="math inline">\(w^0\)</span>, <span class="math inline">\(w^1\)</span>, <span class="math inline">\(w^2\)</span>, <span class="math inline">\(...\)</span> represent <span class="math inline">\(w\)</span> to the power of 0, 1, 2, <span class="math inline">\(...\)</span>
</li>
<li>
<span class="math inline">\(c_1\)</span>, <span class="math inline">\(c_2\)</span>, <span class="math inline">\(c_3\)</span>, <span class="math inline">\(...\)</span> represent the hourly average for the
most recent 1, 2, 3, <span class="math inline">\(...\)</span>
hours.</li>
</ul>
<p>When written this way, it is easy to see that in the extreme case
where <span class="math inline">\(w = 1\)</span> (i.e. if <span class="math inline">\(c_{min} = c_{max}\)</span>) the equation above
reduces to:</p>
<p><span class="math display">\[
NowCast = \frac{\sum_{i=1}^{12}{c_i}}{12}
\]</span></p>
<p>which is just a simple 12-hour arithmetic average. Incidentally, all
12 hourly averages and the 12-hour average itself would all be
equivalent in this case.</p>
<p>In the case of highly variable PM2.5 data, <span class="math inline">\(w\)</span> would be set to the minimum value of
<span class="math inline">\(1/2\)</span>, and the most recent data would
carry the majority of the weight in the equation above.</p>
</div>
<div class="section level2">
<h2 id="implementation-details">Implementation Details<a class="anchor" aria-label="anchor" href="#implementation-details"></a>
</h2>
<div class="section level3">
<h3 id="missing-data">Missing Data<a class="anchor" aria-label="anchor" href="#missing-data"></a>
</h3>
<p>The NowCast algorithm ignores terms corresponding to hours for which
a valid observation is not available. For example, suppose PM2.5 is
invalid for all but the first three and last three hours of a 12-hour
period. Then the PM2.5 NowCast equation takes the following form:</p>
<p><span class="math display">\[
NowCast = \frac
{w^0c_1 + w^1c_2 + w^2c_3 + \color{gray}{\text{[note: middle values
ignored]}} + w^9c_{10} + w^{10}c_{11} + w^{11}c_{12}}
{w^0 + w^1 + w^2 + \color{gray}{\text{[note: middle values ignored]}} +
w^9 + w^{10} + w^{11}}
\]</span></p>
<p>Minimum data availability requirements do apply, however. See the
following section for details.</p>
</div>
<div class="section level3">
<h3 id="data-availability-requirements">Data Availability Requirements<a class="anchor" aria-label="anchor" href="#data-availability-requirements"></a>
</h3>
<p>To get a valid NowCast value, the NowCast algorithm simply requires
valid data for at least two of the three most recent clock hours. This
means that a valid NowCast value can be calculated from as little as two
valid hours, even if 12 hours are typically used in the calculation.</p>
<p>However, note that <a href="https://en.wikipedia.org/wiki/NowCast_(air_quality_index)" class="external-link uri">https://en.wikipedia.org/wiki/NowCast_(air_quality_index)</a>
says:</p>
<blockquote>
<p>Because the most recent hours of data are weighted so heavily in the
NowCast when PM levels are changing, EPA does not report the NowCast
when data is missing for c<sub>1</sub> or c<sub>2</sub>.</p>
</blockquote>
<p>While this seems like a reasonable approach, we could not find a
source for this statement (in the Wikipedia page sources or elsewhere).
We take a compromise approach and still allow valid NowCast values to be
calculated when c<sub>2</sub> is invalid but return <code>NA</code> when
c<sub>1</sub> is invalid.</p>
</div>
<div class="section level3">
<h3 id="argument-includeshortterm">Argument: <code>includeShortTerm</code><a class="anchor" aria-label="anchor" href="#argument-includeshortterm"></a>
</h3>
<p>As mentioned above, the NowCast algorithm only requires two valid
hours to calculate valid values. Does this mean that the
<code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> function can begin reporting valid values
after the second hour in the data (assuming the first two hours are both
valid)?</p>
<p>We assert that it would be inappropriate to do so,
<em>usually</em>.</p>
<p>In most cases a user will have created a <em>mts_monitor</em> object
using one of the <code>~_load()</code>, functions, which return data for
a specific period of time. Data before this period is not necessarily
invalid, it was simply not retrieved. But the function itself has no way
of knowing whether such earlier data exists, so it has no choice but to
consider earlier hours “invalid”. This means that, if followed
by-the-book, the NowCast algorithm could return different values for a
given hour depending on whether or not the earlier data had been
retrieved. This is not a desirable behavior, so, by default, the
<code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> returns invalid NowCast values until the
<span class="math inline">\(N\)</span><sup>th</sup> hour of data.</p>
<p>However, we provide a manual override in
<code>includeShortTerm = TRUE</code> which causes the function to return
valid values as per the bare-bones data availability requirements
described above, treating the hours before the beginning of the data as
invalid. Thus, it can return “valid” NowCast values as early as the
second (valid) hour in the data.</p>
<p>This argument may be useful (or even appropriate) for datasets where
the beginning of the data truly corresponds to the beginning of the
monitoring, such as when a new monitor has just been installed. In this
case, data prior to the first hour is truly invalid since it does not
exist. The argument may also be useful for field personnel looking to
ensure that their monitor has been successfully plugged in to the data
processing pipeline, even if the values themselves are not truly
representative of the data for the past <span class="math inline">\(N\)</span> hours.</p>
</div>
<div class="section level3">
<h3 id="negative-values">Negative Values<a class="anchor" aria-label="anchor" href="#negative-values"></a>
</h3>
<p>In the NowCast literature we find no mention of negative values,
which, while aphysical, are common in air quality monitoring data. Thus,
we do not adjust negative values up to zero in the
<code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> function itself.</p>
<p>Negative values should always be handled prior to converting raw data
to NowCast or AQI values. All of the <code>~_load()</code> functions
handle negative values by <em>lifting</em> them to zero as part of the
data loading process.</p>
</div>
<div class="section level3">
<h3 id="argument-version">Argument: <code>version</code><a class="anchor" aria-label="anchor" href="#argument-version"></a>
</h3>
<p>The <code>version</code> argument sets defaults for the number of
hours in the lookback <span class="math inline">\(N\)</span>
(<code>numHrs</code>), the minimum weight factor <span class="math inline">\(c_{min}\)</span> (<code>weightFactorMin</code>),
and the number of digits to which the final data is truncated
(<code>digits</code>).</p>
<ul>
<li>
<code>version='pm25'</code> (default)
<ul>
<li><code>numHrs &lt;- 12</code></li>
<li><code>weightFactorMin &lt;- 0.5</code></li>
<li><code>digits &lt;- 1</code></li>
</ul>
</li>
<li>
<code>version='ozone'</code>
<ul>
<li><code>numHrs &lt;- 8</code></li>
<li><code>weightFactorMin &lt;- NA</code></li>
<li><code>digits &lt;- 3</code></li>
</ul>
</li>
<li>
<code>version='pmAsian'</code>
<ul>
<li><code>numHrs &lt;- 3</code></li>
<li><code>weightFactorMin &lt;- 0.1</code></li>
<li><code>digits &lt;- 1</code></li>
</ul>
</li>
</ul>
<p>The default setting is <code>version = 'pm25'</code> since this is
the parameter most commonly stored in <em>mts_monitor</em> objects.</p>
<p><code>version = 'ozone'</code> supports the O3 NowCast as described
above.</p>
<p><code>version='pmAsian'</code> supports an alternative shorter-term
NowCast as proposed here: <a href="https://aqicn.org/faq/2015-03-15/air-quality-nowcast-a-beginners-guide/" class="external-link uri">https://aqicn.org/faq/2015-03-15/air-quality-nowcast-a-beginners-guide/</a></p>
<p>Although the NowCast algorithm itself supports PM10, we do not
currently provide functionality for this parameter in the
<code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> function.</p>
</div>
</div>
<div class="section level2">
<h2 id="nowcast-and-aqi-calculations">NowCast and AQI Calculations<a class="anchor" aria-label="anchor" href="#nowcast-and-aqi-calculations"></a>
</h2>
<p>The EPA uses an <a href="https://www.airnow.gov/aqi/aqi-basics/" class="external-link">Air
Quality Index</a> to put different pollutants on the same scale. From
their site:</p>
<blockquote>
<p>Think of the AQI as a yardstick that runs from 0 to 500. The higher
the AQI value, the greater the level of air pollution and the greater
the health concern. For example, an AQI value of 50 represents good air
quality with little potential to affect public health, while an AQI
value over 300 represents hazardous air quality.</p>
</blockquote>
<p>We provide the <code><a href="../reference/monitor_aqi.html">monitor_aqi()</a></code> function to convert the
PM2.5 data in a <em>mts_monitor</em> object into NowCast-based AQI
values in the 0-500 range.</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>The following examples demonstrate the functionality of
<code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> and specifics of its implementation.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>For the following examples we will use the Northwest Megafires data
from the <strong>AirMonitor</strong> package. In particular, we will
look at PM2.5 data from Omak, WA, which was heavily impacted by smoke
from wildfires during the second half of August, 2015:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirMonitor" class="external-link">AirMonitor</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">Omak_ID</span> <span class="op">&lt;-</span> <span class="st">"decef259cdefa79f_530470013_04"</span></span>
<span></span>
<span><span class="co"># Recipe to obtain monitoring data for Omak, WA</span></span>
<span><span class="va">Omak</span> <span class="op">&lt;-</span></span>
<span>  </span>
<span>  <span class="co"># start with NW Megafires dataset</span></span>
<span>  <span class="va">NW_Megafires</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># select the Omak time series</span></span>
<span>  <span class="fu"><a href="../reference/monitor_select.html">monitor_select</a></span><span class="op">(</span><span class="va">Omak_ID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># filter to include only August, 2015</span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDate.html">monitor_filterDate</a></span><span class="op">(</span><span class="fl">20150801</span>, <span class="fl">20150901</span><span class="op">)</span></span></code></pre></div>
<p><img src="NowCast_files/figure-html/Omak_nowcast_plot-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="example-1-basic-formula-verification">Example 1: Basic Formula Verification<a class="anchor" aria-label="anchor" href="#example-1-basic-formula-verification"></a>
</h3>
<p>In the code above we used the <code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> function
to calculate PM2.5 NowCast values for the Omak <em>mts_monitor</em>
object. Let’s see if we can verify the function’s output for a single
hour.</p>
<p>Below is the Omak PM2.5 data for the first 12 hours of 8/21/15. Let’s
see if we can verify the accuracy of the NowCast value for the last hour
in this series, 8/21/15 Hour 11.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Omak_1</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Omak</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082100</span>, <span class="fl">2015082112</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">Omak_1</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code>              datetime decef259cdefa79f_530470013_04
1  2015-08-21 00:00:00                         123.3
2  2015-08-21 01:00:00                          80.2
3  2015-08-21 02:00:00                          49.3
4  2015-08-21 03:00:00                         101.8
5  2015-08-21 04:00:00                          93.7
6  2015-08-21 05:00:00                         143.2
7  2015-08-21 06:00:00                         215.4
8  2015-08-21 07:00:00                         130.6
9  2015-08-21 08:00:00                         129.2
10 2015-08-21 09:00:00                          59.8
11 2015-08-21 10:00:00                          27.4
12 2015-08-21 11:00:00                          46.3</code></pre>
<p>First we’ll pull out just the values themselves, and reverse them so
the most recent values come first (<em>i.e.</em> so the vector
represents <span class="math inline">\(c_1\)</span>, <span class="math inline">\(c_2\)</span>, <span class="math inline">\(...\)</span>, <span class="math inline">\(c_N\)</span>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_1_values</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Omak_1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">example_1_values</span><span class="op">)</span></span></code></pre></div>
<pre><code> [1]  46.3  27.4  59.8 129.2 130.6 215.4 143.2  93.7 101.8  49.3  80.2 123.3</code></pre>
<p>Per the NowCast algorithm, we define <span class="math inline">\(w*\)</span> as <span class="math inline">\(\frac{c_{min}}{c_{max}}\)</span>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">w_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">example_1_values</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">example_1_values</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.1272052</code></pre>
<p>We now define <span class="math inline">\(w\)</span> based on <span class="math inline">\(w^*\)</span> and the minimum weight factor; recall
that <span class="math inline">\(w_{min}=\frac{1}{2}\)</span> for
PM2.5:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="va">w_star</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.5</code></pre>
<p>Thus, the numerator of the NowCast equation for Hour 11</p>
<p><span class="math display">\[
w^0c_1 + w^1c_2 + w^2c_3 + w^3c_4 + w^4c_5 + w^5c_6 + w^6c_7 + w^7c_8 +
w^8c_9 + w^9c_{10} + w^{10}c_{11} + w^{11}c_{12}
\]</span></p>
<p>becomes the following:</p>
<p><span class="math inline">\(0.5^0 \times 46.3 + 0.5^1 \times 27.4 +
0.5^2 \times 59.8 + 0.5^3 \times 129.2 + 0.5^4 \times 130.6 + 0.5^5
\times 215.4\)</span> +<br><span class="math inline">\(0.5^6 \times 143.2 + 0.5^7 \times 93.7 +
0.5^8 \times 101.8 + 0.5^9 \times 49.3 + 0.5^{10} \times 80.2 + 0.5^{11}
\times 123.3\)</span></p>
<p>which we can calculate in R as follows</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">numerator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">^</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span> <span class="op">*</span> <span class="va">example_1_values</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 109.5958</code></pre>
<p>Meanwhile, the denominator</p>
<p><span class="math display">\[
w^0 + w^1 + w^2 + w^3 + w^4 + w^5 + w^6 + w^7 + w^8 + w^9 + w^{10} +
w^{11}
\]</span></p>
<p>becomes the following:</p>
<p><span class="math inline">\(0.5^0 + 0.5^1 + 0.5^2 + 0.5^3 + 0.5^4 +
0.5^5 + 0.5^6 + 0.5^7 + 0.5^8 + 0.5^9 + 0.5^{10} + 0.5^{11}\)</span></p>
<p>which we can calculate in R as follows</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">denominator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">^</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 1.999512</code></pre>
<p>Dividing the numerator by the denominator gives a value of</p>
<pre><code>[1] 54.81126</code></pre>
<p>which we truncate to one decimal place for a final NowCast value of
54.8 for 2015-08-21 11:00 local time.</p>
<p>So how does this compare to our <code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> output
for the same hour.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Omak</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_nowcast.html">monitor_nowcast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082111</span>, <span class="fl">2015082112</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Omak_ID</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 54.8</code></pre>
<p>Right on!</p>
</div>
<div class="section level3">
<h3 id="example-2-short-missing-data-period">Example 2: Short Missing Data Period<a class="anchor" aria-label="anchor" href="#example-2-short-missing-data-period"></a>
</h3>
<p>So we have verified the calculation for a period with 12 valid hours.
But how does the function handle missing data periods? Let’s take a look
at a short period of missing data to find out. We will invalidate a
single hour and see how the NowCast algorithm responds.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Omak_2 with one value missing</span></span>
<span><span class="va">Omak_2</span> <span class="op">&lt;-</span> <span class="va">Omak</span></span>
<span><span class="va">Omak_2</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">564</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">Omak_2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082412</span>, <span class="fl">2015082500</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>              datetime decef259cdefa79f_530470013_04
1  2015-08-24 12:00:00                         461.7
2  2015-08-24 13:00:00                         486.2
3  2015-08-24 14:00:00                         510.4
4  2015-08-24 15:00:00                         583.0
5  2015-08-24 16:00:00                         645.7
6  2015-08-24 17:00:00                         745.5
7  2015-08-24 18:00:00                            NA
8  2015-08-24 19:00:00                         711.0
9  2015-08-24 20:00:00                         683.3
10 2015-08-24 21:00:00                         589.8
11 2015-08-24 22:00:00                         504.6
12 2015-08-24 23:00:00                         478.5</code></pre>
<p>Here we see that the monitor data is missing for 18:00. We want to
verify that this hour is properly excluded from the NowCast calculation
for subsequent hours. We also want to ensure that NowCast returns valid
values for all hours in the vicinity, since all hours meet the minimum
data availability requirements (i.e. two of three most recent hours
valid).</p>
<div class="section level4">
<h4 id="formula-verification">Formula Verification<a class="anchor" aria-label="anchor" href="#formula-verification"></a>
</h4>
<p>Let’s see if we can verify the accuracy of the NowCast value for Hour
23.</p>
<p>We again begin by pulling out our vector of values <span class="math inline">\(c_1\)</span>, <span class="math inline">\(c_2\)</span>, <span class="math inline">\(...\)</span>, <span class="math inline">\(c_N\)</span></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_2_values</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Omak_2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082412</span>, <span class="fl">2015082500</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">example_2_values</span><span class="op">)</span></span></code></pre></div>
<pre><code> [1] 478.5 504.6 589.8 683.3 711.0    NA 745.5 645.7 583.0 510.4 486.2 461.7</code></pre>
<p>and calculating <span class="math inline">\(w*\)</span> and <span class="math inline">\(w\)</span></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">example_2_values</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">example_2_values</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="va">w_star</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.6193159</code></pre>
<p>This time our numerator and denominator should both exclude the 6th
term, since <span class="math inline">\(c_6\)</span> is invalid. So we
have</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validIndexes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">example_2_values</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">numerator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">^</span><span class="op">(</span><span class="va">validIndexes</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">example_2_values</span><span class="op">[</span><span class="va">validIndexes</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">denominator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">^</span><span class="op">(</span><span class="va">validIndexes</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">numerator</span><span class="op">/</span><span class="va">denominator</span></span></code></pre></div>
<pre><code>[1] 543.896</code></pre>
<p>We truncate the value above to one decimal place for a final NowCast
value of 543.8 for 2015-08-24 23:00.</p>
<p>So how does this compare to our <code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> output
for the same hour?</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Omak_2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_nowcast.html">monitor_nowcast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082423</span>, <span class="fl">2015082500</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Omak_ID</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 543.8</code></pre>
<p>Excellent!</p>
</div>
<div class="section level4">
<h4 id="missing-data-verification">Missing Data Verification<a class="anchor" aria-label="anchor" href="#missing-data-verification"></a>
</h4>
<p>A quick look at the monitored data alongside the NowCast data shows
that all NowCast hours are valid except for the c<sub>1</sub> moment
when the monitoring data is also invalid.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">Omak_2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082412</span>, <span class="fl">2015082500</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span><span class="op">$</span><span class="va">nowcast</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Omak_2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_nowcast.html">monitor_nowcast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082412</span>, <span class="fl">2015082500</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Omak_ID</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span></code></pre></div>
<pre><code>              datetime decef259cdefa79f_530470013_04 nowcast
1  2015-08-24 12:00:00                         461.7   403.1
2  2015-08-24 13:00:00                         486.2   444.7
3  2015-08-24 14:00:00                         510.4   477.6
4  2015-08-24 15:00:00                         583.0   530.3
5  2015-08-24 16:00:00                         645.7   588.0
6  2015-08-24 17:00:00                         745.5   666.8
7  2015-08-24 18:00:00                            NA      NA
8  2015-08-24 19:00:00                         711.0   696.4
9  2015-08-24 20:00:00                         683.3   688.9
10 2015-08-24 21:00:00                         589.8   636.1
11 2015-08-24 22:00:00                         504.6   569.4
12 2015-08-24 23:00:00                         478.5   543.8</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="example-3-long-missing-data-period">Example 3: Long Missing Data Period<a class="anchor" aria-label="anchor" href="#example-3-long-missing-data-period"></a>
</h3>
<p>We now look at a longer period of missing data, from the day prior on
8/23/15.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Omak_3 with 5 missing values</span></span>
<span><span class="va">Omak_3</span> <span class="op">&lt;-</span> <span class="va">Omak</span></span>
<span><span class="va">Omak_3</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">538</span><span class="op">:</span><span class="fl">542</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">Omak_3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082312</span>, <span class="fl">2015082400</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>              datetime decef259cdefa79f_530470013_04
1  2015-08-23 12:00:00                         711.8
2  2015-08-23 13:00:00                         734.0
3  2015-08-23 14:00:00                         744.6
4  2015-08-23 15:00:00                         763.8
5  2015-08-23 16:00:00                            NA
6  2015-08-23 17:00:00                            NA
7  2015-08-23 18:00:00                            NA
8  2015-08-23 19:00:00                            NA
9  2015-08-23 20:00:00                            NA
10 2015-08-23 21:00:00                         238.6
11 2015-08-23 22:00:00                         149.9
12 2015-08-23 23:00:00                         149.5</code></pre>
<p>Here we see that the monitored data is missing for Hours 16-20. We
again want to verify that these hours are properly excluded from the
NowCast calculation for subsequent hours. This time we also want to
ensure that NowCast returns invalid values for hours in which the
minimum data availability requirements are not met (i.e. two of three
most recent hours valid).</p>
<div class="section level4">
<h4 id="formula-verification-1">Formula Verification<a class="anchor" aria-label="anchor" href="#formula-verification-1"></a>
</h4>
<p>Let’s see if we can verify the accuracy of the NowCast value for Hour
23.</p>
<p>We again begin by pulling out our vector of values <span class="math inline">\(c_1\)</span>, <span class="math inline">\(c_2\)</span>, <span class="math inline">\(...\)</span>, <span class="math inline">\(c_N\)</span></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_3_values</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Omak_3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082312</span>, <span class="fl">2015082400</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">example_3_values</span><span class="op">)</span></span></code></pre></div>
<pre><code> [1] 149.5 149.9 238.6    NA    NA    NA    NA    NA 763.8 744.6 734.0 711.8</code></pre>
<p>and calculating <span class="math inline">\(w*\)</span> and <span class="math inline">\(w\)</span></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">example_3_values</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">example_3_values</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="va">w_star</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.5</code></pre>
<p>This time our numerator and denominator should both exclude the
4th-8th terms, since <span class="math inline">\(c_4\)</span>, <span class="math inline">\(c_5\)</span>, <span class="math inline">\(c_6\)</span>, <span class="math inline">\(c_7\)</span> and <span class="math inline">\(c_8\)</span> are invalid. So we have</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validIndexes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">example_3_values</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">numerator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">^</span><span class="op">(</span><span class="va">validIndexes</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">example_3_values</span><span class="op">[</span><span class="va">validIndexes</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">denominator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">^</span><span class="op">(</span><span class="va">validIndexes</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">numerator</span><span class="op">/</span><span class="va">denominator</span></span></code></pre></div>
<pre><code>[1] 164.7973</code></pre>
<p>We truncate the value above to one decimal place for a final NowCast
value of 164.7 for 2015-08-23 23:00.</p>
<p>So how does this compare to our <code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> output
for the same hour?</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Omak_3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_nowcast.html">monitor_nowcast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082323</span>, <span class="fl">2015082400</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Omak_ID</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 164.7</code></pre>
<p>Again, right on!</p>
<div class="section level5">
<h5 id="missing-data-verification-1">Missing Data Verification<a class="anchor" aria-label="anchor" href="#missing-data-verification-1"></a>
</h5>
<p>Now we’ll look at the monitored data alongside the NowCast data to
see how the validity of the NowCast data was affected by the missing
monitored hours.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">Omak_3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082312</span>, <span class="fl">2015082400</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span><span class="op">$</span><span class="va">nowcast</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Omak_3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_nowcast.html">monitor_nowcast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082312</span>, <span class="fl">2015082400</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Omak_ID</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span></code></pre></div>
<pre><code>              datetime decef259cdefa79f_530470013_04 nowcast
1  2015-08-23 12:00:00                         711.8   667.8
2  2015-08-23 13:00:00                         734.0   700.9
3  2015-08-23 14:00:00                         744.6   722.8
4  2015-08-23 15:00:00                         763.8   743.3
5  2015-08-23 16:00:00                            NA      NA
6  2015-08-23 17:00:00                            NA      NA
7  2015-08-23 18:00:00                            NA      NA
8  2015-08-23 19:00:00                            NA      NA
9  2015-08-23 20:00:00                            NA      NA
10 2015-08-23 21:00:00                         238.6      NA
11 2015-08-23 22:00:00                         149.9   185.1
12 2015-08-23 23:00:00                         149.5   164.7</code></pre>
<p>There’s a lot going on here so let’s walk through the data one step
at a time.</p>
<p><strong>Hours 12-15</strong>: NowCast data is valid because the
monitored data is valid for all of the three most recent hours. Status:
<span style="color:limegreen">GOOD</span></p>
<p><strong>Hour 16</strong>: This is the first hour for which the
monitored data is invalid. NowCast should also return invalid for this
c<sub>1</sub> timestep. Status: <span style="color:limegreen">GOOD</span></p>
<p><strong>Hour 17</strong>: This NowCast value is invalid because the
monitored data is only valid for one of the three most recent hours
(Hour 15). Status: <span style="color:limegreen">GOOD</span></p>
<p><strong>Hours 18-20</strong>: NowCast is invalid since the monitored
data is valid for none of the three most recent hours. Status: <span style="color:limegreen">GOOD</span></p>
<p><strong>Hour 21</strong>: This is the first hour for which the
monitored data is valid again. However, NowCast still returns an invalid
value this hour since the monitored data is only valid for one of the
three most recent hours (Hour 21). Status: <span style="color:limegreen">GOOD</span></p>
<p><strong>Hour 22</strong>: This is the first hour for which the
NowCast data is valid again. This is because the monitored data is again
valid for two of the three most recent hours (Hours 21 and 22). Status:
<span style="color:limegreen">GOOD</span></p>
<p><strong>Hour 23</strong>: NowCast data is valid because the monitored
data is valid for all of the three most recent hours. Status: <span style="color:limegreen">GOOD</span></p>
<p>So, it appears the <code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> returns data that
has been correctly validated according to the NowCast algorithm and
associated data availability requirements.</p>
</div>
<div class="section level5">
<h5 id="does-most-recent-include-current">Does “most recent” include “current”?<a class="anchor" aria-label="anchor" href="#does-most-recent-include-current"></a>
</h5>
<p>A subtle point about the <code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> function
which falls out of the example above: <strong>the “current” hour is
considered to be a part of the three “most recent clock hours”</strong>.
This may seem strange at first, but to understand why we chose this
approach, one must think about how the data is captured and how
measurement timestamps correspond to the period they actually
represent.</p>
<p>For particle pollution, measurements typically represent the mass of
particles that accumulate on a filter during a set period of time,
e.g. the past hour. Measurements come in at the end of the hour, but
these measurements aren’t necessarily representative of conditions at
the exact times of the measurements. Instead, they are actually
representative of concentrations <strong>during the previous clock
hour</strong>. For example, if an hourly measurement comes in at 12:00,
the measurement is actually representative of data during Hour 11,
<strong>NOT</strong> Hour 12. So we call the 12:00 measurement the Hour
11 data point.</p>
<p>This is really just a labeling convention, and it is no different
from how we treat other datasets. For example, suppose you wanted to
take an average of the low temperatures for every day in July. You would
have to wait until August 1st to do so, since the temperature might
still be dropping at the end of the day on July 31st. But does this mean
you would call this value the average low temperature for August, since
it wasn’t calculated until August? Of course not: the data belongs to
July, even if it couldn’t be calculated until August. It is no different
with particle pollution: the Hour 11 data belongs to Hour 11, even if it
wasn’t calculated until 12:00. As a result of this convention,
timestamps are usually an entire hour (or more) earlier than the time
the measurements were actually taken (exact differences depend on
several factors).</p>
<p>Another reason for including the “current” hour in the NowCast “three
most recent hours” is for speed of updates. Suppose it is 12:04, and a
measurement just came in at 12:00 (the Hour 11 measurement). It would be
inappropriate to wait until 13:00 to calculate the updated NowCast
value. For this reason, we calculate NowCast values using the monitored
data for the “current” hour and the <span class="math inline">\(N-1\)</span> prior hours.</p>
</div>
</div>
<div class="section level4">
<h4 id="example-4-includeshortterm-argument">Example 4: <code>includeShortTerm</code> argument<a class="anchor" aria-label="anchor" href="#example-4-includeshortterm-argument"></a>
</h4>
<p>For our final NowCast example we will explore the
<code>includeShortTerm</code> argument, including a demonstration of why
it defaults to <code>FALSE</code>.</p>
<p>Suppose we wanted to know the NowCast values for Omak for the first
half of 8/25/15, since concentrations were extremely high at the time.
Not thinking about the details of the NowCast algorithm, one might
proceed by filtering in time before creating the nowcast:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Omak</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082500</span>, <span class="fl">2015082600</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_nowcast.html">monitor_nowcast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>              datetime decef259cdefa79f_530470013_04
1  2015-08-25 00:00:00                            NA
2  2015-08-25 01:00:00                            NA
3  2015-08-25 02:00:00                            NA
4  2015-08-25 03:00:00                            NA
5  2015-08-25 04:00:00                            NA
6  2015-08-25 05:00:00                            NA
7  2015-08-25 06:00:00                            NA
8  2015-08-25 07:00:00                            NA
9  2015-08-25 08:00:00                            NA
10 2015-08-25 09:00:00                            NA
11 2015-08-25 10:00:00                            NA
12 2015-08-25 11:00:00                         373.7
13 2015-08-25 12:00:00                         370.0
14 2015-08-25 13:00:00                         364.6
15 2015-08-25 14:00:00                         365.3
16 2015-08-25 15:00:00                         370.5
17 2015-08-25 16:00:00                         434.5
18 2015-08-25 17:00:00                         455.2
19 2015-08-25 18:00:00                         422.8
20 2015-08-25 19:00:00                         338.0
21 2015-08-25 20:00:00                         284.5
22 2015-08-25 21:00:00                         236.4
23 2015-08-25 22:00:00                         201.8
24 2015-08-25 23:00:00                         149.1</code></pre>
<p>Unfortunately, the first 11 hours end up as invalid. But you read in
the documentation that <code>includeShortTerm = TRUE</code> will return
values for the second valid hour onwards. So you try again, this time
setting <code>includeShortTerm = TRUE</code>. Let’s check it out.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Omak</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082500</span>, <span class="fl">2015082600</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_nowcast.html">monitor_nowcast</a></span><span class="op">(</span>includeShortTerm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>              datetime decef259cdefa79f_530470013_04
1  2015-08-25 00:00:00                            NA
2  2015-08-25 01:00:00                         456.3
3  2015-08-25 02:00:00                         451.0
4  2015-08-25 03:00:00                         420.7
5  2015-08-25 04:00:00                         388.4
6  2015-08-25 05:00:00                         389.9
7  2015-08-25 06:00:00                         388.9
8  2015-08-25 07:00:00                         382.7
9  2015-08-25 08:00:00                         378.1
10 2015-08-25 09:00:00                         375.9
11 2015-08-25 10:00:00                         374.7
12 2015-08-25 11:00:00                         373.7
13 2015-08-25 12:00:00                         370.0
14 2015-08-25 13:00:00                         364.6
15 2015-08-25 14:00:00                         365.3
16 2015-08-25 15:00:00                         370.5
17 2015-08-25 16:00:00                         434.5
18 2015-08-25 17:00:00                         455.2
19 2015-08-25 18:00:00                         422.8
20 2015-08-25 19:00:00                         338.0
21 2015-08-25 20:00:00                         284.5
22 2015-08-25 21:00:00                         236.4
23 2015-08-25 22:00:00                         201.8
24 2015-08-25 23:00:00                         149.1</code></pre>
<p>Nice. We were able to get NowCast values for all but the first
hour!</p>
<p>But there’s a problem lurking. Setting
<code>includeShortTerm = TRUE</code> caused the
<code><a href="../reference/monitor_nowcast.html">monitor_nowcast()</a></code> function to treat hours prior to Hour 0
as invalid. <strong>It has no idea that valid data is available for this
period.</strong></p>
<p>As an experiment, let’s see how the NowCast values would look if we
calculated them from a larger dataset that includes the data prior to
8/25/15 Hour 0.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Omak</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># NowCast first</span></span>
<span>  <span class="va">monitor_nowcast</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># then restrict times</span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082500</span>, <span class="fl">2015082600</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span><span class="op">$</span><span class="va">shortTerm_T</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Omak</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># restrict times first</span></span>
<span>  <span class="fu"><a href="../reference/monitor_filterDatetime.html">monitor_filterDatetime</a></span><span class="op">(</span><span class="fl">2015082500</span>, <span class="fl">2015082600</span>, timezone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># then NowCast</span></span>
<span>  <span class="fu"><a href="../reference/monitor_nowcast.html">monitor_nowcast</a></span><span class="op">(</span>includeShortTerm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/monitor_getDataFrame.html">monitor_getData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Omak_ID</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span></code></pre></div>
<pre><code>              datetime decef259cdefa79f_530470013_04 shortTerm_T
1  2015-08-25 00:00:00                         514.5          NA
2  2015-08-25 01:00:00                         485.9       456.3
3  2015-08-25 02:00:00                         465.7       451.0
4  2015-08-25 03:00:00                         411.1       420.7
5  2015-08-25 04:00:00                         372.5       388.4
6  2015-08-25 05:00:00                         382.8       389.9
7  2015-08-25 06:00:00                         384.7       388.9
8  2015-08-25 07:00:00                         376.4       382.7
9  2015-08-25 08:00:00                         373.5       378.1
10 2015-08-25 09:00:00                         374.9       375.9
11 2015-08-25 10:00:00                         374.6       374.7
12 2015-08-25 11:00:00                         373.7       373.7
13 2015-08-25 12:00:00                         370.0       370.0
14 2015-08-25 13:00:00                         364.6       364.6
15 2015-08-25 14:00:00                         365.3       365.3
16 2015-08-25 15:00:00                         370.5       370.5
17 2015-08-25 16:00:00                         434.5       434.5
18 2015-08-25 17:00:00                         455.2       455.2
19 2015-08-25 18:00:00                         422.8       422.8
20 2015-08-25 19:00:00                         338.0       338.0
21 2015-08-25 20:00:00                         284.5       284.5
22 2015-08-25 21:00:00                         236.4       236.4
23 2015-08-25 22:00:00                         201.8       201.8
24 2015-08-25 23:00:00                         149.1       149.1</code></pre>
<p>While not too extreme, we see differences in the NowCast values
calculated by the different approaches, even as late as the 11th hour of
the period. As expected, the values match from the 12th hour on.</p>
<p>The discrepancies displayed above are why, by default,
<code>includeShortTerm = FALSE</code>. It should be used only when
necessary, and with an understanding that the first <span class="math inline">\(N\)</span> hours’ values might not necessarily be
true NowCast values.</p>
<p>If it exists, we recommend always grabbing an extra day of data at
the beginning of the period if you think you might want to calculate
NowCast values on a dataset.</p>
<hr>
<p>Hopefully, we have thoroughly addressed any questions about the
<strong>AirMonitor</strong> implementation of the NowCast algorithm.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jonathan Callahan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
