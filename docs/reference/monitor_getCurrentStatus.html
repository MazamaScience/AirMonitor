<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Get current status of monitors — monitor_getCurrentStatus • AirMonitor</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Get current status of monitors — monitor_getCurrentStatus"><meta property="og:description" content="This function augments monitor$meta with summary information derived
from monitor$data reflecting recent measurements."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AirMonitor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/AirMonitor.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Data_Model.html">Data Model</a>
    </li>
    <li>
      <a href="../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
    <li>
      <a href="../articles/Citations.html">Citations</a>
    </li>
    <li>
      <a href="../articles/NowCast.html">NowCast</a>
    </li>
    <li>
      <a href="../articles/Save_Data_as_CSV.html">Example: Save Data as CSV</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/MazamaScience/AirMonitor/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Get current status of monitors</h1>
    <small class="dont-index">Source: <a href="https://github.com/MazamaScience/AirMonitor/blob/HEAD/R/monitor_getCurrentStatus.R" class="external-link"><code>R/monitor_getCurrentStatus.R</code></a></small>
    <div class="hidden name"><code>monitor_getCurrentStatus.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function augments <code>monitor$meta</code> with summary information derived
from <code>monitor$data</code> reflecting recent measurements.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">monitor_getCurrentStatus</span><span class="op">(</span></span>
<span>  <span class="va">monitor</span>,</span>
<span>  enddate <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  minHours <span class="op">=</span> <span class="fl">18</span>,</span>
<span>  dayBoundary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clock"</span>, <span class="st">"LST"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>monitor</dt>
<dd><p><em>mts_monitor</em> object.</p></dd>


<dt>enddate</dt>
<dd><p>Time relative to which current status is calculated. By
default, it is the latest time in <code>monitor$data$datetime</code>. This time can
be given as a POSIXct time, or a string/numeric value in ymd format (<em>e.g.</em>
20190301). This time converted to UTC.</p></dd>


<dt>minHours</dt>
<dd><p>Minimum number of valid hourly records required to calculate
<code>yesterday_PM2.5_avg</code>. Days with fewer valid records will be assigned <code>NA</code>.</p></dd>


<dt>dayBoundary</dt>
<dd><p>Treatment of daylight savings time:  "clock" uses daylight
savings time as defined in the local timezone, "LST" uses "local standard time"
all year round. (See <code><a href="monitor_dailyStatistic.html">monitor_dailyStatistic()</a></code> for more details.)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The <code>monitor$meta</code> table augmented with current status
information for each time series.</p>
    </div>
    <div id="-last-and-previous-">
    <h2>"Last" and "Previous"</h2>
    

<p>The goal of this function is to provide useful information about what
happened recently with each time series in the provided <em>mts_monitor</em> object.
Devices don't always consistently report data, however, and it is not alwlays
useful to have <code>NA</code>'s reported when there is recent valid data at earlier
times. To address this, <code>monitor_getCurrentStatus()</code> uses <em>last</em> and
<em>previous</em> valid times. These are the time when a monitor most recently
reported data, and the most recent time of valid data before that,
respectively. By reporting on these times, this function ensures that valid
data is returned and provides information on how outdated this information
is. This information can be used in maps to show AQI colored dots when data
is only a few hours old but gray dots when data is older than some threshold.</p>
    </div>
    <div id="calculating-latency">
    <h2>Calculating latency</h2>
    

<p>According to https://docs.airnowapi.org/docs/HourlyDataFactSheet.pdf
a datum assigned to 2pm represents the average of data between 2pm and 3pm.
So, if we check at 3:15pm and see that we have a value for 2pm but not 3pm
then the data are completely up-to-date with zero latency.</p>
<p><code>monitor_getCurrentStatus()</code> defines latency as the difference between
a time index and the next most recent time index associated with a
valid value. If there is no more recent time index, then the difference is
measured to the given <code>enddate</code> parameter. Because <em>mts_monitor</em>
objects are defined on an hourly axis, these differences have units of hours.</p>
<p>For example, if the recorded values for a monitor are
<code>[16.2, 15.8, 16.4, NA, 14.0, 12.5, NA, NA, 13.3, NA]</code>, then the <em>last</em>
valid value is 13.3 with an index is 9, and the <em>previous</em> valid value is 12.4
with an index of 6. The <em>last</em> latency is then 1 (hour before the end), and the
<em>previous</em> latency is 3 (hours before the last valid value).</p>
    </div>
    <div id="summary-data">
    <h2>Summary data</h2>
    

<p>The table created by <code>monitor_getCurrentStatus()</code> includes per-time series
summary information calculated from <code>monitor$data</code>.
The additional data fields added to <code>monitor$meta</code> are listed below:</p>
<dl><dt>currentStatus_processingTime</dt>
<dd><p>Time at which this function was run</p></dd>

  <dt>currentStatus_enddate</dt>
<dd><p>Time relative to which "currency" is calculated</p></dd>

  <dt>last_validIndex</dt>
<dd><p>Row index of the last valid mesurement in <code>monitor$data</code></p></dd>

  <dt>previous_validIndex</dt>
<dd><p>Row index of the previous valid measurement in <code>monitor$data</code></p></dd>

  <dt>last_validTime</dt>
<dd><p>UTC time associated with <code>last_validIndex</code></p></dd>

  <dt>previous_validTime</dt>
<dd><p>UTC time associated with <code>previous_validIndex</code></p></dd>

  <dt>last_latency</dt>
<dd><p>Hours between <code>last_validTime</code> and <code>endtime</code></p></dd>

  <dt>previous_latency</dt>
<dd><p>Hours between <code>previous_validTime</code> and<code>last_validTime</code></p></dd>

  <dt>last_validLocalTimestamp</dt>
<dd><p>Local time representation of <code>last_validTime</code></p></dd>

  <dt>previous_validLocalTimestamp</dt>
<dd><p>Local time representation of <code>previous_validTime</code></p></dd>

  <dt>last_PM2.5</dt>
<dd><p>Last valid PM2.5 measurement</p></dd>

  <dt>previous_PM2.5</dt>
<dd><p>Previous valid PM2.5 measurement</p></dd>

  <dt>last_nowcast</dt>
<dd><p>Last valid PM2.5 NowCast value</p></dd>

  <dt>previous_nowcast</dt>
<dd><p>Previous valid PM2.5 NowCast value</p></dd>

  <dt>yesterday_PM2.5_avg</dt>
<dd><p>Daily average PM2.5 for the day prior to <code>enddate</code></p></dd>


</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Fail gracefully if any resources are not available</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirMonitor" class="external-link">AirMonitor</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">monitor</span> <span class="op">&lt;-</span> <span class="fu"><a href="airnow_loadLatest.html">airnow_loadLatest</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># TODO:  Needed before rebuilding of v2 database with fullAQSID</span></span></span>
<span class="r-in"><span><span class="va">monitor</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">fullAQSID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"840"</span>, <span class="va">monitor</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">AQSID</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">currentStatus</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">monitor</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="monitor_filterMeta.html">monitor_filter</a></span><span class="op">(</span><span class="va">stateCode</span> <span class="op">==</span> <span class="st">"WA"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">monitor_getCurrentStatus</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span>, silent <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jonathan Callahan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

